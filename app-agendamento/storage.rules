rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Regra para a pasta de imagens de estabelecimentos
    match /establishments/{ownerId}/{allPaths=**} {
      allow read: if true;

      // Apenas o dono autenticado pode escrever, e apenas ficheiros do tipo e tamanho permitidos
      allow write: if request.auth != null 
                  && request.auth.uid == ownerId
                  && request.resource.size < 5 * 1024 * 1024 // Menos de 5MB
                  // ALTERAÇÃO CRÍTICA: Permite apenas os tipos de ficheiro JPEG ou PNG.
                  && request.resource.contentType in ['image/jpeg', 'image/png'];
    }

    // Regra para a pasta de fotos de perfil dos profissionais
    match /professionals/{ownerId}/{allPaths=**} {
      allow read: if true;
      
      // Apenas o dono autenticado pode escrever, e apenas ficheiros do tipo e tamanho permitidos
      allow write: if request.auth != null 
                  && request.auth.uid == ownerId 
                  && request.resource.size < 5 * 1024 * 1024 // Menos de 5MB
                  // ALTERAÇÃO CRÍTICA: Permite apenas os tipos de ficheiro JPEG ou PNG.
                  && request.resource.contentType in ['image/jpeg', 'image/png'];
    }
  }
}